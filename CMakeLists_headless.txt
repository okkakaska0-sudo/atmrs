cmake_minimum_required(VERSION 3.15)

project(AutoTunePlugin VERSION 1.0.0)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Build configuration for headless audio processing only
message(STATUS "Building AutoTune Plugin - Audio Processing Only (No GUI)")

# Add JUCE - minimal configuration for audio processing only
include(FetchContent)
FetchContent_Declare(
    JUCE
    URL https://github.com/juce-framework/JUCE/archive/refs/tags/7.0.9.zip
    DOWNLOAD_EXTRACT_TIMESTAMP true
)

# Configure JUCE for headless audio-only build
set(JUCE_BUILD_EXTRAS OFF CACHE BOOL "" FORCE)
set(JUCE_BUILD_EXAMPLES OFF CACHE BOOL "" FORCE) 
set(JUCE_ENABLE_MODULE_SOURCE_GROUPS OFF CACHE BOOL "" FORCE)
set(JUCE_BUILD_HELPER_TOOLS OFF CACHE BOOL "" FORCE)
set(JUCE_COPY_PLUGIN_AFTER_BUILD OFF CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(JUCE)

# Define source files - full functionality preserved
set(SOURCES
    Source/PluginProcessor.cpp
    Source/PluginEditor_minimal.cpp
    Source/PitchCorrectionEngine.cpp
    Source/Parameters.cpp
    Source/PresetManager.cpp
    Source/ModeSelector.cpp
    Source/Utils.cpp
    Source/LookAndFeel.cpp
    Source/AIModelLoader.cpp
)

# Add plugin target - VST3 only for audio processing
juce_add_plugin(AutoTunePlugin
    COMPANY_NAME "ReplicaStudio"
    IS_SYNTH FALSE
    NEEDS_MIDI_INPUT FALSE
    NEEDS_MIDI_OUTPUT FALSE
    IS_MIDI_EFFECT FALSE
    EDITOR_WANTS_KEYBOARD_FOCUS FALSE
    COPY_PLUGIN_AFTER_BUILD FALSE
    PLUGIN_MANUFACTURER_CODE "Repl"
    PLUGIN_CODE "ATun"
    FORMATS VST3 AU Standalone
    PRODUCT_NAME "AutoTune Plugin"
)

# Add source files
target_sources(AutoTunePlugin PRIVATE ${SOURCES})

# Compiler definitions - disable all GUI
target_compile_definitions(AutoTunePlugin
    PUBLIC
        JUCE_WEB_BROWSER=0
        JUCE_USE_CURL=0
        JUCE_VST3_CAN_REPLACE_VST2=0
        JUCE_DISPLAY_SPLASH_SCREEN=0
        JUCE_REPORT_APP_USAGE=0
        JUCE_STRICT_REFCOUNTEDPTR=1
        JUCE_USE_XRANDR=0
        JUCE_USE_XINERAMA=0
        JUCE_USE_XCURSOR=0
    PRIVATE
        JUCE_APPLICATION_NAME_STRING="$<TARGET_PROPERTY:AutoTunePlugin,JUCE_PLUGIN_NAME>"
        JUCE_APPLICATION_VERSION_STRING="$<TARGET_PROPERTY:AutoTunePlugin,JUCE_PLUGIN_VERSION>"
)

# Link libraries - full JUCE functionality for macOS compatibility
target_link_libraries(AutoTunePlugin
    PRIVATE
        juce::juce_audio_utils
        juce::juce_audio_processors
        juce::juce_dsp
        juce::juce_gui_basics
        juce::juce_core
    PUBLIC
        juce::juce_recommended_config_flags
        juce::juce_recommended_lto_flags
        juce::juce_recommended_warning_flags
)

# Include directories
target_include_directories(AutoTunePlugin PRIVATE Source)

message(STATUS "AutoTune Plugin configured for headless audio processing")