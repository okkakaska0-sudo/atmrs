cmake_minimum_required(VERSION 3.15)

project(AutoTunePlugin VERSION 1.0.0)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Force macOS-only build mode without any Linux dependencies
message(STATUS "Building AutoTune Plugin for macOS compatibility ONLY")
set(MACOS_BUILD TRUE)
set(APPLE TRUE)

# Set macOS-specific compiler flags
set(CMAKE_OSX_ARCHITECTURES "x86_64;arm64")
set(CMAKE_OSX_DEPLOYMENT_TARGET "10.15")

# Plugin sources
set(PLUGIN_SOURCES
    Source/PluginProcessor.cpp
    Source/PluginEditor.cpp
    Source/PitchCorrectionEngine.cpp
    Source/Parameters.cpp
    Source/Utils.cpp
    Source/LookAndFeel.cpp
    Source/PresetManager.cpp
    Source/ModeSelector.cpp
    Source/AIModelLoader.cpp
)

# Create a simple library target instead of JUCE plugin
add_library(AutoTunePluginLib STATIC ${PLUGIN_SOURCES})

# Set include directories
target_include_directories(AutoTunePluginLib PUBLIC Source)

# Define macOS-specific macros
target_compile_definitions(AutoTunePluginLib 
    PUBLIC
        MACOS_BUILD=1
        USE_RUBBERBAND=0
        USE_EIGEN=0
        USE_KISSFFT=0
        USE_LIBSAMPLERATE=0
        USE_ONNX=0
        JUCE_HEADLESS=1
        JUCE_WEB_BROWSER=0
        JUCE_USE_CURL=0
)

# Compiler flags for macOS compatibility
target_compile_options(AutoTunePluginLib PRIVATE 
    -fPIC
    -O3
    -DNDEBUG
    -Wno-deprecated
    -Wno-unused-variable
)

message(STATUS "‚úÖ AutoTune Plugin configured for macOS-only mode")
message(STATUS "üìÅ Plugin sources: ${PLUGIN_SOURCES}")
message(STATUS "üéØ Target: Static library (AutoTunePluginLib)")